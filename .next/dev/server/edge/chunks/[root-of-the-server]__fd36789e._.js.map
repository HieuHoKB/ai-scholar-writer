{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/hhkb/ai-scholar-writer/src/app/api/generate/route.ts"],"sourcesContent":["import OpenAI from \"openai\";\n\n// Initialize OpenRouter client\nconst openrouter = new OpenAI({\n\tapiKey: process.env.OPENROUTER_API_KEY || \"\",\n\tbaseURL: \"https://openrouter.ai/api/v1\",\n});\n\nexport const runtime = \"edge\";\n\nexport async function POST(req: Request) {\n\ttry {\n\t\tconst { prompt, section, context, model } = await req.json();\n\n\t\t// Debug log (remove in production)\n\t\tconsole.log(\"Generation request:\", { model, section });\n\n\t\t// Build system message for academic writing\n\t\tconst systemMessage = `You are an academic writing assistant helping users write research papers.\n    You write in formal academic English following APA 7th edition style.\n    ${context ? `Context from previous sections: ${context}` : \"\"}\n    \n    Write high-quality academic content for the ${section} section.\n    Focus on clarity, precision, and scholarly tone.\n    Use appropriate academic vocabulary and sentence structures.`;\n\n\t\t// Call OpenRouter API with streaming\n\t\tconst completion = await openrouter.chat.completions.create({\n\t\t\tmodel: model || \"openai/gpt-oss-120b:free\",\n\t\t\tmessages: [\n\t\t\t\t{ role: \"system\", content: systemMessage },\n\t\t\t\t{ role: \"user\", content: prompt },\n\t\t\t],\n\t\t\ttemperature: 0.7,\n\t\t\tmax_tokens: 2000,\n\t\t\tstream: true,\n\t\t});\n\n\t\t// Create a ReadableStream from the OpenRouter response\n\t\tconst readableStream = new ReadableStream({\n\t\t\tasync start(controller) {\n\t\t\t\tconst encoder = new TextEncoder();\n\t\t\t\ttry {\n\t\t\t\t\tfor await (const chunk of completion) {\n\t\t\t\t\t\tconst content = chunk.choices[0]?.delta?.content || \"\";\n\t\t\t\t\t\tif (content) {\n\t\t\t\t\t\t\tcontroller.enqueue(encoder.encode(content));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontroller.close();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Stream processing error:\", error);\n\t\t\t\t\tcontroller.error(error);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn new Response(readableStream, {\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"text/plain; charset=utf-8\",\n\t\t\t\t\"Transfer-Encoding\": \"chunked\",\n\t\t\t},\n\t\t});\n\t} catch (error: unknown) {\n\t\tconsole.error(\"AI Generation error:\", error);\n\n\t\t// Return more detailed error information\n\t\tconst errorMessage =\n\t\t\terror instanceof Error ? error.message : \"Unknown error\";\n\t\treturn new Response(\n\t\t\tJSON.stringify({\n\t\t\t\terror: \"Failed to generate content\",\n\t\t\t\tdetails: errorMessage,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tstatus: 500,\n\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t},\n\t\t);\n\t}\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,+BAA+B;AAC/B,MAAM,aAAa,IAAI,2OAAM,CAAC;IAC7B,QAAQ,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAC1C,SAAS;AACV;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACtC,IAAI;QACH,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAE1D,mCAAmC;QACnC,QAAQ,GAAG,CAAC,uBAAuB;YAAE;YAAO;QAAQ;QAEpD,4CAA4C;QAC5C,MAAM,gBAAgB,CAAC;;IAErB,EAAE,UAAU,CAAC,gCAAgC,EAAE,SAAS,GAAG,GAAG;;gDAElB,EAAE,QAAQ;;gEAEM,CAAC;QAE/D,qCAAqC;QACrC,MAAM,aAAa,MAAM,WAAW,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YAC3D,OAAO,SAAS;YAChB,UAAU;gBACT;oBAAE,MAAM;oBAAU,SAAS;gBAAc;gBACzC;oBAAE,MAAM;oBAAQ,SAAS;gBAAO;aAChC;YACD,aAAa;YACb,YAAY;YACZ,QAAQ;QACT;QAEA,uDAAuD;QACvD,MAAM,iBAAiB,IAAI,eAAe;YACzC,MAAM,OAAM,UAAU;gBACrB,MAAM,UAAU,IAAI;gBACpB,IAAI;oBACH,WAAW,MAAM,SAAS,WAAY;wBACrC,MAAM,UAAU,MAAM,OAAO,CAAC,EAAE,EAAE,OAAO,WAAW;wBACpD,IAAI,SAAS;4BACZ,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;wBACnC;oBACD;oBACA,WAAW,KAAK;gBACjB,EAAE,OAAO,OAAO;oBACf,QAAQ,KAAK,CAAC,4BAA4B;oBAC1C,WAAW,KAAK,CAAC;gBAClB;YACD;QACD;QAEA,OAAO,IAAI,SAAS,gBAAgB;YACnC,SAAS;gBACR,gBAAgB;gBAChB,qBAAqB;YACtB;QACD;IACD,EAAE,OAAO,OAAgB;QACxB,QAAQ,KAAK,CAAC,wBAAwB;QAEtC,yCAAyC;QACzC,MAAM,eACL,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC1C,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;YACd,OAAO;YACP,SAAS;QACV,IACA;YACC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IAEF;AACD"}}]
}