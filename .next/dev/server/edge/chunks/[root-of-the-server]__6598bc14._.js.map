{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/hhkb/ai-scholar-writer/src/app/api/suggestions/route.ts"],"sourcesContent":["import OpenAI from \"openai\";\n\nconst openrouter = new OpenAI({\n\tapiKey: process.env.OPENROUTER_API_KEY || \"\",\n\tbaseURL: \"https://openrouter.ai/api/v1\",\n});\n\nexport const runtime = \"edge\";\n\nexport async function POST(req: Request) {\n\ttry {\n\t\tconst { content, section, type } = await req.json();\n\n\t\tlet systemMessage = \"\";\n\t\tlet userPrompt = \"\";\n\n\t\tswitch (type) {\n\t\t\tcase \"improve\":\n\t\t\t\tsystemMessage = `You are an academic writing editor. Improve the following text for academic writing quality. \n        Focus on: clarity, academic vocabulary, sentence structure, flow, and APA style.`;\n\t\t\t\tuserPrompt = `Improve this ${section} content:\\n\\n${content}`;\n\t\t\t\tbreak;\n\n\t\t\tcase \"citation\":\n\t\t\t\tsystemMessage = `You are an academic citation expert. Suggest relevant citations for the content provided.\n        Focus on: peer-reviewed sources, recent publications (last 5 years), and seminal works in the field.`;\n\t\t\t\tuserPrompt = `Suggest citations for this ${section} content:\\n\\n${content}`;\n\t\t\t\tbreak;\n\n\t\t\tcase \"expand\":\n\t\t\t\tsystemMessage = `You are an academic writing coach. Expand the content while maintaining academic rigor.\n        Focus on: adding depth, supporting arguments with evidence, logical flow.`;\n\t\t\t\tuserPrompt = `Expand this ${section} content with more detail:\\n\\n${content}`;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tsystemMessage = \"You are an academic writing assistant.\";\n\t\t\t\tuserPrompt = `Review this content: ${content}`;\n\t\t}\n\n\t\tconst completion = await openrouter.chat.completions.create({\n\t\t\tmodel: \"anthropic/claude-3-haiku\",\n\t\t\tmessages: [\n\t\t\t\t{ role: \"system\", content: systemMessage },\n\t\t\t\t{ role: \"user\", content: userPrompt },\n\t\t\t],\n\t\t\ttemperature: 0.5,\n\t\t\tmax_tokens: 1500,\n\t\t\tstream: true,\n\t\t});\n\n\t\t// Create a ReadableStream from the OpenRouter response\n\t\tconst readableStream = new ReadableStream({\n\t\t\tasync start(controller) {\n\t\t\t\tconst encoder = new TextEncoder();\n\t\t\t\ttry {\n\t\t\t\t\tfor await (const chunk of completion) {\n\t\t\t\t\t\tconst text = chunk.choices[0]?.delta?.content || \"\";\n\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\tcontroller.enqueue(encoder.encode(text));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontroller.close();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Stream processing error:\", error);\n\t\t\t\t\tcontroller.error(error);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn new Response(readableStream, {\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"text/plain; charset=utf-8\",\n\t\t\t\t\"Transfer-Encoding\": \"chunked\",\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(\"Suggestion error:\", error);\n\t\treturn new Response(\n\t\t\tJSON.stringify({ error: \"Failed to generate suggestions\" }),\n\t\t\t{\n\t\t\t\tstatus: 500,\n\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t},\n\t\t);\n\t}\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,aAAa,IAAI,2OAAM,CAAC;IAC7B,QAAQ,QAAQ,GAAG,CAAC,kBAAkB,IAAI;IAC1C,SAAS;AACV;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACtC,IAAI;QACH,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEjD,IAAI,gBAAgB;QACpB,IAAI,aAAa;QAEjB,OAAQ;YACP,KAAK;gBACJ,gBAAgB,CAAC;wFACmE,CAAC;gBACrF,aAAa,CAAC,aAAa,EAAE,QAAQ,aAAa,EAAE,SAAS;gBAC7D;YAED,KAAK;gBACJ,gBAAgB,CAAC;4GACuF,CAAC;gBACzG,aAAa,CAAC,2BAA2B,EAAE,QAAQ,aAAa,EAAE,SAAS;gBAC3E;YAED,KAAK;gBACJ,gBAAgB,CAAC;iFAC4D,CAAC;gBAC9E,aAAa,CAAC,YAAY,EAAE,QAAQ,8BAA8B,EAAE,SAAS;gBAC7E;YAED;gBACC,gBAAgB;gBAChB,aAAa,CAAC,qBAAqB,EAAE,SAAS;QAChD;QAEA,MAAM,aAAa,MAAM,WAAW,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YAC3D,OAAO;YACP,UAAU;gBACT;oBAAE,MAAM;oBAAU,SAAS;gBAAc;gBACzC;oBAAE,MAAM;oBAAQ,SAAS;gBAAW;aACpC;YACD,aAAa;YACb,YAAY;YACZ,QAAQ;QACT;QAEA,uDAAuD;QACvD,MAAM,iBAAiB,IAAI,eAAe;YACzC,MAAM,OAAM,UAAU;gBACrB,MAAM,UAAU,IAAI;gBACpB,IAAI;oBACH,WAAW,MAAM,SAAS,WAAY;wBACrC,MAAM,OAAO,MAAM,OAAO,CAAC,EAAE,EAAE,OAAO,WAAW;wBACjD,IAAI,MAAM;4BACT,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;wBACnC;oBACD;oBACA,WAAW,KAAK;gBACjB,EAAE,OAAO,OAAO;oBACf,QAAQ,KAAK,CAAC,4BAA4B;oBAC1C,WAAW,KAAK,CAAC;gBAClB;YACD;QACD;QAEA,OAAO,IAAI,SAAS,gBAAgB;YACnC,SAAS;gBACR,gBAAgB;gBAChB,qBAAqB;YACtB;QACD;IACD,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;YAAE,OAAO;QAAiC,IACzD;YACC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IAEF;AACD"}}]
}